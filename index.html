<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pizza Order</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #fafafa;
    }
    h1 { text-align: center; }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-top: 20px;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: center;
      cursor: pointer;
    }
    .card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 8px;
    }
    .card h3 {
      margin: 10px 0 5px;
      font-size: 18px;
    }
    .card p { margin: 0; color: #444; }

    /* Popup */
    .popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .popup-content {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      max-width: 400px;
      width: 100%;
    }
    .popup-content img {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .variant {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
    }
    .variant:hover {
      background: #f0f0f0;
    }
    .close-btn {
      float: right;
      cursor: pointer;
      font-weight: bold;
      font-size: 18px;
    }

    /* Order Summary */
    #order-summary {
      margin-top: 30px;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #order-summary h2 { margin-top: 0; }

    /* Form */
    .form-group { margin: 10px 0; }
    label { display: block; margin-bottom: 5px; }
    input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      background: #28a745;
      color: #fff;
      cursor: pointer;
    }
    button:hover { background: #218838; }
  </style>
</head>
<body>

  <h1>Pizza Order</h1>

  <!-- Product Grid -->
  <div class="grid" id="product-grid"></div>

  <!-- Popup -->
  <div class="popup" id="popup">
    <div class="popup-content">
      <span class="close-btn" onclick="closePopup()">&times;</span>
      <img id="popup-img" src="" alt="">
      <h3 id="popup-name"></h3>
      <div id="popup-variants"></div>
      <div style="margin-top:10px;">
        <label>Quantity:</label>
        <input type="number" id="popup-qty" min="1" value="1">
      </div>
      <button onclick="addToCart()">Add to Cart</button>
    </div>
  </div>

  <!-- Order Summary -->
  <div id="order-summary">
    <h2>Your Order</h2>
    <ul id="order-list"></ul>
    <p><strong>Total Quantity:</strong> <span id="total-qty">0</span></p>
    <p><strong>Total Price:</strong> ₦<span id="total-price">0</span></p>
  </div>

  <!-- User Details -->
  <div style="margin-top:20px;">
    <h2>Your Details</h2>
    <div class="form-group">
      <label>First Name:</label>
      <input type="text" id="fname">
    </div>
    <div class="form-group">
      <label>Last Name:</label>
      <input type="text" id="lname">
    </div>
    <div class="form-group">
      <label>Phone Number:</label>
      <input type="text" id="phone">
    </div>
    <div class="form-group">
      <label>Child’s Class:</label>
      <input type="text" id="childclass">
    </div>
    <button onclick="submitOrder()">Submit Order</button>
  </div>

  <script>
    // Replace with your deployed Apps Script URL
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby5THVFsizWwJaIr2p_NUzwLzP9_TOW7NwqCADD8B5a0eoe-ouUk6Sbk5nzw9bfqNxu/exec";

    // Products
    const products = [
      {name:"Margherita", prices:{Medium:8600, Large:12200, "X-Large":17500}, img:"images/margherita.png"},
      {name:"BBQ Meatball", prices:{Medium:9600, Large:13400, "X-Large":18800}, img:"images/bbq-meatball.png"},
      {name:"Pepperoni Supreme", prices:{Medium:9600, Large:13400, "X-Large":18800}, img:"images/pepperoni-supreme.png"},
      {name:"Southern Style BBQ Chicken", prices:{Medium:10500, Large:13900, "X-Large":19900}, img:"images/southern-style-bbq-chicken.png"},
      {name:"BBQ Chicken", prices:{Medium:10050, Large:13900, "X-Large":19900}, img:"images/bbq-chicken.png"},
      {name:"Chicken Suya", prices:{Medium:10050, Large:13900, "X-Large":19900}, img:"images/chicken-suya.png"},
      {name:"Chicken Supreme", prices:{Medium:10050, Large:13900, "X-Large":19900}, img:"images/chicken-supreme.png"},
      {name:"BBQ Mega Meat", prices:{Medium:10500, Large:15400, "X-Large":21700}, img:"images/bbq-mega-meat.png"},
      {name:"Shawarma", prices:{Medium:10500, Large:15400, "X-Large":21700}, img:"images/shawarma.png"},
      {name:"Naija Fiesta", prices:{Medium:10500, Large:15400, "X-Large":21700}, img:"images/naija-fiesta.png"},
      {name:"Cheesy Bread", prices:{Standard:4000}, img:"images/cheesy-bread.png"},
      {name:"Cheesy Sausage Bread", prices:{Standard:5000}, img:"images/cheesy-sausage-bread.png"},
      {name:"Cheesy Chicken Suya", prices:{Standard:5000}, img:"images/cheesy-chicken-suya.png"},
      {name:"Cheesy Grilled Chicken", prices:{Standard:5000}, img:"images/cheesy-grilled-chicken.png"},
      {name:"BBQ Sauce Calzone", prices:{Standard:8000}, img:"images/bbq-sauce-calzone.png"},
      {name:"Pizza Sauce Calzone", prices:{Standard:8000}, img:"images/pizza-sauce-calzone.png"},
      {name:"Suya Sauce Calzone", prices:{Standard:8000}, img:"images/suya-sauce-calzone.png"},
      {name:"Roasted Chicken 2pcs", prices:{Standard:4000}, img:"images/roasted-chicken-2pcs.png"},
      {name:"Roasted Chicken 5pcs", prices:{Standard:9000}, img:"images/roasted-chicken-5pcs.png"},
      {name:"Jollof Rice with Roast Chicken", prices:{Standard:2500}, img:"images/jollof-rice-roast-chicken.png"},
      {name:"Jollof Rice Only", prices:{Standard:1500}, img:"images/jollof-rice.png"},
      {name:"Aquafina", prices:{Standard:800}, img:"images/aquafina.png"},
      {name:"7up", prices:{Standard:800}, img:"images/7up.png"},
      {name:"Pepsi", prices:{Standard:800}, img:"images/pepsi.png"},
      {name:"Mirinda Orange", prices:{Standard:800}, img:"images/mirinda-orange.png"},
      {name:"Teem Bitter Lemon", prices:{Standard:800}, img:"images/teem-bitter-lemon.png"},
      {name:"Chicken Wings 4pcs", prices:{Standard:4000}, img:"images/chicken-wings-4pcs.png"},
      {name:"Chicken Wings 7pcs", prices:{Standard:7000}, img:"images/chicken-wings-7pcs.png"},
      {name:"French Vanilla", prices:{Standard:9900}, img:"images/french-vanilla.png"},
      {name:"Cake Batter", prices:{Standard:9900}, img:"images/cake-batter.png"},
    ];

    // Render product cards
    const grid = document.getElementById("product-grid");
    products.forEach((p, i) => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${p.img}" alt="${p.name}">
        <h3>${p.name}</h3>
        <p>₦${Object.values(p.prices)[0]}</p>
      `;
      card.onclick = () => openPopup(i);
      grid.appendChild(card);
    });

    let currentProduct = null;
    let cart = [];

    function openPopup(index) {
      currentProduct = products[index];
      document.getElementById("popup-img").src = currentProduct.img;
      document.getElementById("popup-name").innerText = currentProduct.name;
      const variantsDiv = document.getElementById("popup-variants");
      variantsDiv.innerHTML = "";
      for (let size in currentProduct.prices) {
        const div = document.createElement("div");
        div.className = "variant";
        div.innerHTML = `<span>${size}</span><span>₦${currentProduct.prices[size]}</span>`;
        div.onclick = () => selectVariant(size, currentProduct.prices[size]);
        variantsDiv.appendChild(div);
      }
      document.getElementById("popup").style.display = "flex";
    }

    function closePopup() {
      document.getElementById("popup").style.display = "none";
    }

    let selectedVariant = null;
    function selectVariant(size, price) {
      selectedVariant = {size, price};
    }

    function addToCart() {
      const qty = parseInt(document.getElementById("popup-qty").value);
      if (!selectedVariant) { alert("Please select a size"); return; }
      cart.push({
        name: currentProduct.name,
        size: selectedVariant.size,
        price: selectedVariant.price,
        qty: qty
      });
      updateSummary();
      closePopup();
    }

    function updateSummary() {
      const list = document.getElementById("order-list");
      list.innerHTML = "";
      let totalQty = 0;
      let totalPrice = 0;
      cart.forEach(item => {
        totalQty += item.qty;
        totalPrice += item.price * item.qty;
        const li = document.createElement("li");
        li.textContent = `${item.name} (${item.size}) x${item.qty} - ₦${item.price * item.qty}`;
        list.appendChild(li);
      });
      document.getElementById("total-qty").innerText = totalQty;
      document.getElementById("total-price").innerText = totalPrice;
    }

    async function submitOrder() {
      const data = {
        name: document.getElementById("fname").value,
        surname: document.getElementById("lname").value,
        phone: document.getElementById("phone").value,
        childClass: document.getElementById("childclass").value,
        cart: cart,
        qty: parseInt(document.getElementById("total-qty").innerText),
        total: parseInt(document.getElementById("total-price").innerText)
      };

      try {
        const response = await fetch(SCRIPT_URL, {
          method: "POST",
          body: JSON.stringify(data),
          headers: {"Content-Type": "application/json"}
        });
        const result = await response.json();
        if (result.status === "success") {
          alert("Order submitted successfully!");
          cart = [];
          updateSummary();
        } else {
          alert("Error: " + result.message);
        }
      } catch (err) {
        alert("Failed to submit order");
        console.error(err);
      }
    }
  </script>
</body>
</html>

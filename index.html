<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Pizza Order Form</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #fafafa; }
    h1, h2 { text-align: center; }
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-top: 20px;
    }
    .item {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
      border-radius: 8px;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .item img {
      max-width: 100%;
      border-radius: 6px;
    }
    #modalOverlay {
      display: none;
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    #modal {
      background: white;
      padding: 20px;
      border-radius: 5px;
      width: 300px;
    }
    #summary, #formSection { margin-top: 30px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    #orderSummaryPage { display: none; margin-top: 30px; }
  </style>
</head>
<body>

  <h1>Pizza Order</h1>

  <!-- Product Grid -->
  <div id="itemsGrid" class="grid">
    <!-- 33 placeholder products -->
    <!-- Repeat with product names and different prices -->
    <script>
      const products = [];
      for (let i = 1; i <= 33; i++) {
        products.push({
          name: "Pizza " + i,
          prices: { standard: 8+i, large: 11+i, xlarge: 14+i },
          img: "https://via.placeholder.com/200?text=Pizza+" + i
        });
      }
    </script>
  </div>

  <!-- Modal -->
  <div id="modalOverlay">
    <div id="modal">
      <h3 id="modalItemName"></h3>
      <div>
        <label><input type="radio" name="size" value="standard"> Standard (<span id="priceStandard"></span>)</label><br>
        <label><input type="radio" name="size" value="large"> Large (<span id="priceLarge"></span>)</label><br>
        <label><input type="radio" name="size" value="xlarge"> X-Large (<span id="priceXLarge"></span>)</label>
      </div>
      <div style="margin-top:10px;">
        <label>Quantity: <input type="number" id="qty" value="1" min="1"></label>
      </div>
      <div style="margin-top:10px;">
        <button onclick="addItem()">Add to Order</button>
        <button onclick="closeModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Current Order -->
  <div id="summary">
    <h2>Your Order</h2>
    <div id="currentOrderItems"></div>
    <div>
      <strong>Total Quantity: </strong><span id="totalQty">0</span><br>
      <strong>Total Price: $</strong><span id="totalPrice">0.00</span>
    </div>
  </div>

  <!-- Customer Info Form -->
  <div id="formSection">
    <h2>Your Details</h2>
    <form id="orderForm" onsubmit="return handleSubmit(event);">
      <div><label>First Name: <input type="text" id="firstName" required></label></div>
      <div><label>Last Name: <input type="text" id="lastName" required></label></div>
      <div><label>Phone Number: <input type="text" id="phone" required></label></div>
      <div><label>Child’s Class: <input type="text" id="childClass" required></label></div>
      <div style="margin-top:10px;"><button type="submit">Submit Order</button></div>
    </form>
  </div>

  <!-- Order Summary Page -->
  <div id="orderSummaryPage">
    <h2>Order Summary</h2>
    <table id="summaryTable">
      <thead>
        <tr>
          <th>Name</th><th>Order Quantity</th><th>Amount to Pay</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
  // Render products dynamically
  const grid = document.getElementById("itemsGrid");
  products.forEach(p => {
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <img src="${p.img}" alt="${p.name}">
      <span>${p.name}</span><br>
      <button onclick='openModal("${p.name}", ${JSON.stringify(p.prices)})'>Order</button>
    `;
    grid.appendChild(div);
  });

  let currentOrder = [];
  let pricing = {};
  let modalItem = null;

  function openModal(itemName, priceObj) {
    modalItem = itemName;
    pricing = priceObj;
    document.getElementById('modalItemName').innerText = itemName;
    document.getElementById('priceStandard').innerText = priceObj.standard.toFixed(2);
    document.getElementById('priceLarge').innerText = priceObj.large.toFixed(2);
    document.getElementById('priceXLarge').innerText = priceObj.xlarge.toFixed(2);
    document.querySelector('input[name="size"][value="standard"]').checked = true;
    document.getElementById('qty').value = 1;
    document.getElementById('modalOverlay').style.display = 'flex';
  }

  function closeModal() {
    document.getElementById('modalOverlay').style.display = 'none';
  }

  function addItem() {
    const size = document.querySelector('input[name="size"]:checked').value;
    const qty = parseInt(document.getElementById('qty').value, 10);
    const price = pricing[size] * qty;
    currentOrder.push({ item: modalItem, size, qty, price });
    updateSummary();
    closeModal();
  }

  function updateSummary() {
    const container = document.getElementById('currentOrderItems');
    container.innerHTML = '';
    let totalQty = 0;
    let totalPrice = 0;
    currentOrder.forEach((oi) => {
      const div = document.createElement('div');
      div.innerText = `${oi.qty} × ${oi.size} ${oi.item} — $${oi.price.toFixed(2)}`;
      container.appendChild(div);
      totalQty += oi.qty;
      totalPrice += oi.price;
    });
    document.getElementById('totalQty').innerText = totalQty;
    document.getElementById('totalPrice').innerText = totalPrice.toFixed(2);
  }

  function handleSubmit(event) {
    event.preventDefault();
    const firstName = document.getElementById('firstName').value;
    const lastName  = document.getElementById('lastName').value;
    const phone     = document.getElementById('phone').value;
    const childClass= document.getElementById('childClass').value;

    const orderQty = currentOrder.reduce((sum, o) => sum + o.qty, 0);
    const orderTotal = currentOrder.reduce((sum, o) => sum + o.price, 0);

    const data = {
      firstName, lastName, phone, childClass,
      orderQty, orderTotal,
      items: currentOrder
    };

    fetch(https://script.google.com/macros/s/AKfycbwQO4DL4SPd3JWB876_PIfzlKEqJ-6TtHjLFtlZarbe7rkmv4xBGiGezPErnF_2eTk0/exec, {
      method: "POST",
      mode: "cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    })
    .then(resp => resp.json())
    .then(res => { showSummaryPage(data); })
    .catch(err => { alert("Error submitting order: " + err); });

    return false;
  }

  function showSummaryPage(data) {
    document.getElementById('itemsGrid').style.display = 'none';
    document.getElementById('summary').style.display = 'none';
    document.getElementById('formSection').style.display = 'none';
    const summaryDiv = document.getElementById('orderSummaryPage');
    summaryDiv.style.display = 'block';
    const tbody = document.querySelector('#summaryTable tbody');
    tbody.innerHTML = '';
    const tr = document.createElement('tr');
    const tdName = document.createElement('td');
    tdName.innerText = data.firstName + ' ' + data.lastName;
    const tdQty = document.createElement('td');
    tdQty.innerText = data.orderQty;
    const tdAmt = document.createElement('td');
    tdAmt.innerText = '$' + data.orderTotal.toFixed(2);
    tr.appendChild(tdName);
    tr.appendChild(tdQty);
    tr.appendChild(tdAmt);
    tbody.appendChild(tr);
  }
</script>

</body>
</html>
